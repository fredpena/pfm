<?xml version='1.0' encoding='UTF-8' ?>
<!-- Author: Jose De Los Santos -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/templatePhasePlan.xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="pagetitle">
        #{confProjectBean.project.name}
    </ui:define>    

    <ui:define name="title">
        #{msgs.iter_dist_title}
    </ui:define>

    <ui:define name="subtitle">
        #{msgs.iter_dist_title}
    </ui:define>

    <ui:define name="body">


        <h:form id="test">
            <div>
                <p:outputLabel id="iteration_title" value="#{msgs.iteration} : " />
                <p:selectOneMenu id="selectIteration" value="#{iterationBean.iterEntity.id}">
                    <f:selectItems value="#{iterationBean.allIterations}" var="iteration" itemLabel="#{iteration.iterValue} : #{iteration.typeIteration}" itemValue="#{iteration.id}" />
                    <p:ajax event="change"  listener="#{iterationBean.handleIterationChange}" update="test"/>
                </p:selectOneMenu>
                <p:outputLabel id="activity" value="#{msgs.activity}" />
            </div>
            
            <p:dataTable var="activity" value="#{activitiesBean.activities}"   styleClass="tableIterationDistribution">
                <p:columnGroup type="header">
                    <p:row>
                        <p:column rowspan="1" headerText="#{msgs.name}" />
                        <p:column colspan="1" headerText="#{msgs.code}" />
                        <p:column colspan="1" headerText="#{msgs.total_units}" />
                        <p:column colspan="1" headerText="#{msgs.setNumberResourceHours}" />
                        <p:column colspan="1" headerText="#{msgs.available_units}" />
                    </p:row>
                </p:columnGroup>

                <p:subTable var="subActivity" value="#{activity.subActivity}">
                    <f:facet name="header">
                        <h:outputText value="#{activity.name} : #{activity.code}" />
                    </f:facet>
                    <p:column >
                        <h:outputText value="#{subActivity.name}" />
                    </p:column>

                    <p:column >
                        <h:outputText value="#{subActivity.code}" />
                    </p:column>

                    <p:column >
                        #{workUnitBean.getWorkUnitsByIterAndActivity(activity, iterationBean.iterEntity)}
                        <h:outputText value="#{workUnitBean.getNumSubActivityUnits(subActivity, iterationBean.iterEntity, false)}" />
                    </p:column>

                    <p:column >
                        <h:outputText value="#{workUnitBean.getNumSubActivityUnits(subActivity, iterationBean.iterEntity, true)/4}" />
                    </p:column>

                    <p:column >
                        <h:outputText value="#{workUnitBean.getNumSubActivityUnits(subActivity, iterationBean.iterEntity, true)}" />
                    </p:column>
                    
                </p:subTable>
            </p:dataTable>              
            <p:dataList value="#{workerBean.workers}" var="worker" styleClass="workers_list">
                <f:facet name="header">
                    #{msgs.setNumberResourceWorker}
                </f:facet>
                #{worker.name}
            </p:dataList>
        </h:form>
    </ui:define>
</ui:composition>
