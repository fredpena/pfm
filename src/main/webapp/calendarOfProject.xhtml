<?xml version='1.0' encoding='UTF-8' ?>
<!-- Author: manuel rodrÃ­guez& ppbust & manualvgar-->

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"                
                xmlns:p="http://primefaces.org/ui"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                template="/templates/templateHome.xhtml">

    <ui:define name="pagetitle">
        #{confProjectBean.project.name}
    </ui:define>    

    <ui:define name="title">
        Home
    </ui:define>

    <ui:define name="subtitle">
        Project's Calendar
    </ui:define>

    <ui:define name="body">

        <h:outputScript target="head">
            function markHolidaysAndReportedDays(date) { 
            var holidays = new Array(#{fn:join(calendarProjectBean.getHolidays(), ',')}); 
            for (var i = 0; i &#60; holidays.length; i++) 
            { if(date.getTime() == new Date(holidays[i]).getTime()) 
            return [true,'holiday']; } 
            return [true, '']; }
        </h:outputScript> 
        <h:panelGroup id="infoCalendar" layout="block">            
            <p class="CalendarFrom"><span>Since:</span>#{calendarProjectBean.startDate}</p>
            <p class="CalendarTo"><span>Until:</span>#{calendarProjectBean.endDate}</p>
            <p class="workingDays">Working days</p>
            <p class="totalDays">#{calendarProjectBean.workingDays}</p>
        </h:panelGroup>

        <h:panelGroup id="formCalendar" layout="block">
            <h:form id="form_calendario">

                <p:growl id="growl" showDetail="true"/>
                <p:calendar id="calProject" value="#{calendarProjectBean.date1}" navigator="true" mode="inline" mindate="#{calendarProjectBean.startDate}" maxdate="#{calendarProjectBean.endDate}" beforeShowDay="markHolidaysAndReportedDays">                    
                    <p:ajax event="dateSelect" oncomplete="add.enable()" listener="#{calendarProjectBean.llena}" update="nameDate descriptionDate"/>
                </p:calendar>

                <p:watermark for="nameDate" value="#{msgs.name}" />
                <p:watermark for="descriptionDate" value="#{msgs.description}" />  
                <h:panelGrid columns="1" id="tableHolidayForm">
                    <span class="titTableFormCal">Holiday's Name:</span>
                    <h:inputText id="nameDate" label="Name" value="#{calendarProjectBean.name}" />
                    <span class="titTableFormCal">Holiday's Description:</span>
                    <h:inputText id="descriptionDate" label="Description" value="#{calendarProjectBean.description}" />
                    <h:panelGroup layout="block">
                        <p:commandButton id="addHoliday" value="Add" action="#{calendarProjectBean.handleDateSelect}" widgetVar="add" onclick="add.disable()" update=":infoCalendar" oncomplete="javascript:location.reload(true)"/>
                        <p:commandButton id="editdate" value="Edit" action="#{calendarProjectBean.updateDateSelect}"/>
                        <p:commandButton id="removeHoliday" value="Remove"  action="#{calendarProjectBean.deleteDateSelect}" oncomplete="javascript:location.reload(true)"/>
                    </h:panelGroup>
                </h:panelGrid>
            </h:form>

        </h:panelGroup>

    </ui:define>
</ui:composition>